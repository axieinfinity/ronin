# This yaml is example for creating an rpc node using snapshot pvc.
# helm diff upgrade --install rpc-snapshot-node   ~/axis/helm-kubernetes-services/charts/k8s-service/ -f ~/ronin/gke/values/rpc/ronin-node/snapshot-prd.yaml

replicaCount: 1

deployment:
  enabled: False

ingress:
  enabled: false

service:
  enabled: False

statefulset:
  enabled: True

podAnnotations:
  "prometheus.io/scrape": "true"
  "prometheus.io/path": "/debug/metrics/prometheus"
  "prometheus.io/port": "6060"


containerImage:
  repository: gcr.io/test-servers-256610/ronin_ronin
  tag: master-b8e047656
  pullPolicy: IfNotPresent

containerPorts:
  peer:
    port: 30303
    protocol: TCP
  http:
    disabled: true
  https:
    disabled: true
  metric:
    port: 6060
    protocol: TCP
  rpc:
    port: 8545
    protocol: TCP

containerCommand:
  - "./entrypoint.sh"

applicationName: rpc-node

envVars:
  BOOTNODES: "enode://a166ab6437cf370bc604097529a0fb6a8a4836bb85833fbf588b130cb73fe0517940d10c5d89c0e3e1c2800a774ac1ae2108d62cb4608556e41bc1fc4482241a@35.193.159.26:30303" # ronin-mainet-0
  NETWORK_ID: 2020
  VERBOSITY: "3"
  PRIVATE_KEY: " "
  PASSWORD: "123456"
  SYNC_MODE: "snap"
  MINE: "false"
  RONIN_PARAMS: "--rpc.allow-unprotected-txs --http.api eth,web3,personal,txpool --metrics.addr 0.0.0.0 --metrics"
  ETHSTATS_ENDPOINT: $(INSTANCE_NAME):xQj2MZPaN6@stats.roninchain.com:443

additionalContainerEnv:
  - name: INSTANCE_NAME
    valueFrom:
      fieldRef:
        fieldPath: metadata.name

# Chaindata path: /ronin/data/ronin

persistentVolumes:
  ronin-chain:
    accessMode: ReadWriteOnce
    size: 700Gi
    storageClass: premium-rwo
    mountPath: "/ronin"
    dataSource: ronin-rpc-snapshot # Replace to the created snapshot.

containerResources:
  requests:
    memory: 2.5Gi
    cpu: 2
  limits:
    memory: 8Gi
    cpu: 5

nodeSelector:
  node_pool: "pool-rpc-nodes-snapshot"

tolerations:
- key: "node_pool"
  operator: "Equal"
  value: "pool-rpc-nodes-snapshot"
  effect: "NoSchedule"

affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
    - labelSelector:
        matchExpressions:
        - key: application
          operator: In
          values:
          - rpc-ronin
      topologyKey: kubernetes.io/hostname

imagePullSecrets:
  - gcr-json-key

additionalDeploymentLabels:
  application: rpc-ronin

additionalPodLabels:
  application: rpc-ronin

configMaps:
 prune-state-configmap:
   as: volume
   mountPath: /etc/prune-state
   defaultMode: "0777"

initContainers:
  - name: prune-state
    image: "gcr.io/test-servers-256610/ronin_ronin:master-b8e047656"
    imagePullPolicy: IfNotPresent
    command:
      - "/etc/prune-state/prune_state.sh"
    volumeMounts:
    - name: "ronin-chain"
      mountPath: "/ronin"
      readOnly: false
    - name: prune-state-configmap-volume
      mountPath: "/etc/prune-state"

customPreStopCommand:
  - "kill"
  - "-INT"
  - "1"

shutdownDelay: 0
terminationGracePeriodSeconds: 300

livenessProbe:
 httpGet:
   path: /
   port: rpc

readinessProbe:
  httpGet:
    path: /
    port: rpc